# Matchmaking Diagnostics Notes

이 문서는 `AutoMatchProgress` 자동 매칭 오버레이가 어떤 상태를 거치며 동작하는지 점검하기 위한 로그 시그널을 정리합니다. 실 서비스에서 "자동 참가가 왜 안 되지?" 같은 문의가 들어왔을 때 아래 로그를 확인하면 원인을 빠르게 좁힐 수 있습니다.

## 주요 로그 포인트

- `상태 변경`: 대기열 상태가 `idle → queued → matched`로 전환될 때마다 콘솔에 이전/현재 상태와 매치 코드가 기록됩니다.
- `참가 차단 요인 업데이트`: 뷰어 세션·역할 정보·캐릭터 선택 등 자동 참가를 막는 조건이 생기거나 해소되면 변화된 메시지 목록이 출력됩니다.
- `자동 참가 오류`: 큐 참가 요청이 실패하면 오류 메시지가 `console.warn`으로 남고, 해소되면 별도 안내 로그가 찍힙니다.
- `확인 단계 변경`: 매칭 확정 이후 합의 카운트다운이 시작/완료/실패로 바뀌면 남은 시간과 함께 단계가 기록됩니다.
- `자동 참가 서명 초기화`: 2025-10 업데이트로 뷰어·히어로·역할이 바뀌거나 큐 상태가 `idle`로 되돌아오면 `[AutoMatchProgress] 참가 정보가 변경되어 자동 참가 서명을 초기화합니다.` 혹은 `대기열 상태가 초기화되어 자동 참가 서명을 재설정합니다.` 로그가 찍히며 재시도가 트리거됩니다.

## 활용 팁

1. 브라우저 개발자 도구에서 `AutoMatchProgress` 관련 로그만 필터링하면 매칭 진입 흐름을 빠르게 재현할 수 있습니다.
2. 차단 요인이 반복해서 등장한다면, `useMatchQueue`에서 불러오는 사용자/역할/히어로 데이터 싱크를 확인해 보세요.
3. 확인 단계가 `failed`로 떨어지는 경우에는 `rank/start-session` API 응답이나 버튼 클릭 여부를 우선적으로 검증하면 됩니다.
4. 자동 참가 서명 초기화 로그가 보이지 않는다면 브라우저가 이전 서명을 유지하고 있는 것일 수 있으니, `localStorage`의 `selectedHeroId` 값과 역할 선택 UI가 동기화돼 있는지 확인합니다.

이 로그들은 QA 환경에서도 동일하게 찍히므로, 회귀 테스트 시 매칭 흐름이 기대대로 이어지는지 검증하는 참고 자료로 사용할 수 있습니다.
