# 프롬프트 세트 재저장 가이드 — 변수 규칙 최신화

StartClient에서 "전역 변수 규칙이 구버전 형식이라 안전한 기본 파서로 불러왔습니다. 제작기에서 세트를 다시 저장해 주세요."와 같은 경고가 뜨면, 해당 세트의 변수 규칙이 `VARIABLE_RULES_VERSION`(현재 2)과 맞지 않아 기본 안전 경로로 복원된 상태입니다. 아래 절차를 따르면 제작기(Maker)에서 몇 단계만으로 세트를 다시 저장하고 경고를 해소할 수 있습니다.

## 1. 경고가 필요한 세트 확인
1. StartClient 배너 또는 로컬 콘솔에 경고가 노출된 슬롯 번호/범위를 확인합니다.
2. 경고 문구에 포함된 범위(전역/로컬, 슬롯 번호)를 기록해 제작기에서 동일 슬롯을 빠르게 찾습니다.
3. 동일 세트를 여러 명이 편집 중이라면, 노션/슬랙 등 협업 채널에 경고 메시지를 공유해 중복 수정이 발생하지 않도록 합니다.

> ⚠️ StartClient가 경고를 띄우면 해당 슬롯의 변수 규칙은 안전 기본값(조건 제거)으로 불러오므로, 전투 응답 품질이 저하되기 전에 세트를 재저장해야 합니다.

## 2. 제작기에서 세트 불러오기
1. Maker 좌측 탐색기에서 경고가 발생한 게임/세트를 선택합니다.
2. 슬롯 트리에서 경고에 언급된 슬롯 번호를 찾아 선택합니다.
3. 우측 패널의 **변수 규칙**(Auto/Manual/Active) 탭을 모두 펼쳐 현재 규칙이 기대대로 남아 있는지 눈으로 확인합니다.

> 이전 버전(배열 기반)으로 저장된 세트라도 Maker UI에선 최신 구조로 보여집니다. 규칙이 누락됐거나 비어 있다면 최근 백업 JSON을 불러온 뒤 다시 저장하세요.

## 3. 세트 재저장
1. 슬롯 또는 세트 상단의 **저장(Save)** 버튼을 클릭합니다.
2. 저장이 끝나면 Maker 우측 상단의 토스트(성공 알림)를 확인합니다.
3. 동일 세트 내 다른 슬롯도 경고가 있었다면, 슬롯을 전환하며 반복 저장합니다.
4. 모든 저장이 끝나면 **배포(Publish)** 버튼을 눌러 최신 버전을 확정합니다.

> 저장 후 Maker는 자동으로 `version: 2` 메타를 부여합니다. 별도 수동 수정이 필요하지 않습니다.

## 4. 재저장 후 검증
1. `maker-export` 혹은 Supabase 관리 콘솔에서 해당 세트 JSON을 확인해 `var_rules_*` 블록에 `"version": 2`가 들어 있는지 확인합니다.
2. 로컬에서 `npm run dev`로 StartClient를 다시 띄우고, 동일 세트를 로드합니다.
3. 배너에 경고가 사라졌는지 확인하고, 콘솔에 남아 있던 경고 로그가 더 이상 발생하지 않는지 체크합니다.
4. QA는 재저장된 슬롯을 중심으로 `/api/rank/play` 통합 시나리오(DC-01~03)를 실행해 실제 전투 응답이 기대대로 유지되는지 확인합니다.

## 5. 여러 세트를 한 번에 업데이트해야 할 때
- Maker에서 **세트 내보내기(Export)** → JSON 편집 → **가져오기(Import)** → 저장을 반복하면 빠르게 최신 버전으로 갱신할 수 있습니다.
- 내보낸 JSON을 git에 보관하고, 슬롯 범위를 두 명 이상이 분담해 저장하면 충돌을 줄일 수 있습니다.
- 재저장 작업이 끝나면 `rank-blueprint-progress-2025-11-07.md` 타임라인에 완료 시간을 남겨 후속 QA가 참고할 수 있도록 합니다.

## 6. 체크리스트
- [ ] 경고가 뜬 슬롯 번호/범위를 기록했다.
- [ ] Maker에서 해당 슬롯 규칙이 의도와 일치하는지 확인했다.
- [ ] 저장/배포 후 JSON에 `version: 2`가 포함돼 있음을 확인했다.
- [ ] StartClient 경고와 콘솔 로그가 사라졌는지 검증했다.
- [ ] QA 통합 시나리오(DC-01~03) 결과가 정상임을 확인했다.

---
느낀 점: 경고와 문서를 바로 연결해두니 제작기 담당자가 우왕좌왕하지 않고 대응할 수 있겠다는 확신이 들었습니다.
추가로 필요한 점: 장기적으로는 Maker에서 저장 전에 버전 불일치 여부를 선제적으로 검출해주는 UI 경고가 있으면 좋겠습니다.
진행사항: StartClient 경고 문구에 맞춘 제작기 재저장 절차와 후속 검증 체크리스트를 정리했습니다.
